<!DOCTYPE html>
<html>
<head>
    <title>Streaming Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        #output {
            border: 1px solid #ccc;
            padding: 20px;
            min-height: 200px;
            background: #f5f5f5;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .log {
            margin-top: 20px;
            padding: 10px;
            background: #fff;
            border: 1px solid #ddd;
            max-height: 300px;
            overflow-y: auto;
            font-size: 12px;
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px;
        }
    </style>
</head>
<body>
    <h1>WebSocket Streaming Test</h1>
    <p>This test sends one word every 0.1 seconds and displays them as they arrive.</p>
    
    <button onclick="startTest()">Start Test</button>
    <button onclick="clearOutput()">Clear</button>
    
    <h2>Output:</h2>
    <div id="output"></div>
    
    <h2>Log:</h2>
    <div id="log" class="log"></div>

    <script>
        let ws = null;
        let messageContent = '';
        
        function log(msg) {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function clearOutput() {
            document.getElementById('output').textContent = '';
            document.getElementById('log').innerHTML = '';
            messageContent = '';
            log('Output cleared');
        }
        
        function startTest() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                log('WebSocket already connected');
                return;
            }
            
            // Connect to the test endpoint
            const wsUrl = 'ws://sf.lti.cs.cmu.edu:8000/ws/test-stream';
            log(`Connecting to ${wsUrl}...`);
            
            ws = new WebSocket(wsUrl);
            
            ws.onopen = () => {
                log('WebSocket connected!');
                log('Sending test message...');
                ws.send(JSON.stringify({ type: 'start_test' }));
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                log(`Received: type=${data.type}, content="${data.content || ''}"`);
                
                if (data.type === 'chunk') {
                    messageContent += data.content;
                    document.getElementById('output').textContent = messageContent;
                    log(`Total length now: ${messageContent.length}`);
                } else if (data.type === 'complete') {
                    log('Stream complete!');
                    ws.close();
                }
            };
            
            ws.onerror = (error) => {
                log(`WebSocket error: ${error}`);
            };
            
            ws.onclose = () => {
                log('WebSocket closed');
                ws = null;
            };
        }
    </script>
</body>
</html>



